% ridgemodel303 MATLAB Code File
% Description: MATLAB code for ridge regression model
function ridgemodel303(t,y,PowerList,RhoVals,p,CentreTheData)
% This rudimentary script fits a polynomial function to the one D data
% given by vectors t and y.  The model used is F(x,t) = sum x_j t^pj
% where x_j are coefficients determined by the fitting process and 
% pj is the jth power as given in PowerList.   The model is plotted 
% against the data points for each rho value in RhoVals.   p is the 
% number of points used to plot each curve (default = 201).
%
% USAGE: ridgemodel303(t,y,PowerList,RhoVals,p,CentreTheData)
%

format compact;
if ~exist('p'),  p = 201;  end
if ~exist('CentreTheData'),  CentreTheData = 0;  end
% Make sure powers are non-negative integers.
PowerList = round(max(PowerList,0));
NrCurves = max( size(RhoVals) );

% Get the number of data points and number of terms in the model
k = max(size(t));   n = max(size(PowerList));
% Make sure data t,y are column vectors
[row,col] = size(y);    if col > 1  y = y';  end
[row,col] = size(t);    if col > 1  t = t';  end

% Make sure data t values, and RhoVals are in increasing order
[t,index] = sort(t);  y = y(index);  RhoVals = sort(RhoVals,'ascend');

% Set up data centering if needed
ytrue = y;   
if CentreTheData,  
    ymean = mean(y);  y = y - mean(y);
    fprintf('\n\n The data has been centred on mean(y) = %18.9g \n\n',ymean);
else
    fprintf('\n\n The data has NOT been centred. \n\n');    
end

% Get the Design Matrix A, ATA = A^T A and RHS vector ATy = A^T y.
[A,ATA,ATy] = GetDesignMatrix(t,y,PowerList,k,n);

% Plot F(x,t) and the data points across the range of t values.
tmin = min(t);  tmax = max(t);  
tVals = tmin + (tmax - tmin)*[0:p-1]/(p-1);
plot(t,ytrue,'bo');  hold on;
plot(t,ytrue,'c*');  hold on;
xlabel('Curves go black -.-. blue --- green and red ... as rho increases.  This axis t.');
ylabel('Model curves against data (circles).  This axis: y and F(x,t).');
for jjc = 1:NrCurves
   Fvals = GetModelCurve(ATA,ATy,PowerList,tVals,RhoVals(jjc),p,n);
   if CentreTheData,  Fvals = Fvals + ymean;  end
   if mod(jjc,4) == 1,  plot(tVals,Fvals,'k-.');  hold on;  end
   if mod(jjc,4) == 2,  plot(tVals,Fvals,'b--');  hold on;  end
   if mod(jjc,4) == 3,  plot(tVals,Fvals,'g-');  hold on;  end
   if mod(jjc,4) == 0,  plot(tVals,Fvals,'r:');  hold on;  end
end
    

return

% -------------------------------------------------
function [A,ATA,ATy] = GetDesignMatrix(t,y,PowerList,k,n)

A = zeros(k,n);
for jj = 1:n  A(:,jj) = t.^PowerList(jj);  end
ATA = A'*A;  ATy = A'*y;
return

% -------------------------------------------------
function Fvals = GetModelCurve(ATA,ATy,PowerList,tVals,rho,p,n)

Fvals = zeros(p,1);
x = ( ATA + rho*eye(n) ) \ ATy;  
for jj = 1:p
    Fvals(jj) = (tVals(jj).^PowerList) * x;
end
return

% Add your ridgemodel303 MATLAB code here
